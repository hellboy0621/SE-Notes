# JVM 总览
***
### 总览
&ensp;&ensp;&ensp;&ensp;总的来说，JVM的相关知识分为两大块：

- 内存分配与管理：这块是面试常考点，设计内存模型与分配，垃圾回收算法，相关调优
  - 内存模型
  - 垃圾回收（GC）
- 代码编译与优化：
  - 字节码编译（解释执行）
  - JNT机器码编译（编译执行）

## 代码执行工程
原始代码--字节码--JVM编译机器码运行

## 内存模型
JVM不仅负责字节码的分析（JIT）和执行（runtime），同时还内置了自动内存分配机制

Java内存模式主要为下面五个

- 堆：所有线程共享，几乎所有的对象和数组分配到其中
	- 新生代
		- eden
		- survivor
			- from survivor
			- to survivor
	- 老生代
	- 元空间
- 程序计数器：记录各个线程执行字节码的地址，用于分支、循环、跳转、异常、线程恢复
- 方法区：所有线程共享，存放已被虚拟机加载的类相关信息
- 虚拟机栈：线程私有的内存空间
- 本地方法栈：与虚拟机栈类似，但由C语言实现

## 代码分析
- 首先进行类加载，方法区数据增加
- 代码执行，堆数据增加，栈数据增加

### 类编译加载过程
.java文件--类编译-->.class文件--类加载-->连接（验证、准备、解析）--初始化-->字节码--运行时编译-->机器码

- 类编译：编译后的文件注意包含常量池和方法表集合
- 类加载：不同的实现类由不同的类加载器加载，JDK 中的本地方法类一般由根加载器（Bootstrp loader）加载进来，JDK 中内部实现的扩展类一般由扩展加载器（ExtClassLoader ）实现加载，而程序中的类文件则由系统加载器（AppClassLoader ）实现加载
	- 类初始化：执行构造器，收集类初始代码（包含静态变量赋值语句、静态代码块、静态方法），静态代码块和静态变量初始化方向从上到下（执行中先执行静态，后构造函数）
- 即时编译
	- 方法内联
	- 栈上分配
	- 所消除
	- 标量替换